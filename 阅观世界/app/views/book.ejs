<!DOCTYPE html>
<html lang="zh">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"> 
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>书籍信息页</title>
	<!-- <link rel="stylesheet" type="text/css" href="./css/loading.css"> -->
	<link rel="stylesheet" type="text/css" href="/stylesheets/main.css">
	<!-- <link rel="preload" href="./fonts/Electrolize.woff2" as="font" crossorigin> -->
	<style type="text/css">
		@font-face {
			font-family: 'Electrolize';
			font-style: normal;
			font-weight: 400;
			font-display: swap;
			src: local('Electrolize'), local('Electrolize-Regular'), 
			url(./fonts/Electrolize.woff2) format('woff2'),
			url(./fonts/Electrolize.woff) format('woff');
			unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
		}
        *{
		    margin: 0;
		    padding: 0;
		    font-family: 'Nunito', sans-serif;
		    color: black;
		}
		canvas{
		    margin: 0;
		    padding: 0px 0px 0px 0px;
		    display: block; 
		    touch-action: none; 
		}
		.header{
			width: 100%;
			height: 80px;
			background-color: white;
			z-index: 98;
			position: fixed;
			top: 0px;
			opacity: .9;
			box-shadow:0 0 10px orange;
		}
		.headernav{
			width: 1150px;
			height: 80px;
			margin: 0 auto;
			box-sizing: border-box;
			background-image: url(/images/logo.svg);
			background-position: auto center;
			background-repeat: no-repeat;
			background-size: 80px 80px;
		}
		.navlist{
			width: 1000px;
			height: 80px;
			margin-left: 120px;
			display: flex;
			justify-content: space-between;
			align-items: center;
			position: relative;
		}
		.navlist a{
			text-decoration: none;
			text-shadow: 0 0 20px black;
			color: black;

		}
		a:hover{
			text-shadow: 0 0 20px orange;;    
	    }
	    a:active{
            color: black;
	    }
		
		.content{
			width: 1150px;
			margin: 0 auto;
		}
		.content img{
            width: 150px;
            height: 216px;
			padding-left: 10px;
            border-radius: 0px 130px 130px 0px;
            margin-top: 30px;
        }
		.abrief{
			width: 1150px;
			height: 50px;
			background-color: gainsboro;
			margin: 0 auto;
			text-align: center;
			text-indent: 10px;
			line-height: 50px;
            opacity: 0.5;
            border-radius: 10px;
            margin-top: 10px;
		}
        .abrief1{
			width: 1150px;
			height: 50px;
			background-color: gainsboro;
			margin: 0 auto;
			text-align: center;
			text-indent: 10px;
			line-height: 50px;
            opacity: 0.5;
            border-radius: 10px;
		}
		.content p{
			font-size: 14px; 
		}
        .content p:nth-child(4){
            display: block;
            position: absolute;
            top: 100px;
            left: 400px;
            z-index: 9;
            font-size: 25px
        }
        .content p:nth-child(5){
            display: block;
            position: absolute;
            top: 140px;
            left: 405px;
            z-index: 9;
            font-size: 18px
        }
        .content p:nth-child(6){
            display: block;
            position: absolute;
            top: 170px;
            left: 405px;
            z-index: 9;
            font-size: 18px
        }
        .content p:nth-child(7){
            display: block;
            position: absolute;
            top: 200px;
            left: 405px;
            z-index: 9;
            font-size: 18px
        }
		.content p:nth-child(8){
            text-indent: 18px;
			font-size: 14px;
			
		}
		.content p:nth-child(12){
			font-size: 14px;
		}
		.content .aaa{
			display: block;
			text-decoration: none;
			width: 200px;
			height: 50px;
			background-color:orange;
            position: absolute;
            top: 260px;
            left: 405px;
            border-radius: 5px;
            font-size: 25px;
            color: white;
            text-align: center;
            line-height: 50px;
		}
		.kongbai{
			width: 100%;
			height: 30px;
		}
		.tankuang{
			width: 100%;
			height: 100%;
			background-image: url(/images/man.png);
		    background-repeat:repeat;
			position: fixed;
			top: 0px;
            left: 0px;
			z-index: 99;
			opacity: 1;
			animation: donghua1 .3s ease-out
		}
		@keyframes donghua1 {
		from{
			opacity: 0;
			height:20%
		}to{
            opacity: 1;
			height:100%
		}
		
	
	}
		.close{
			position: absolute;
			top: 30px;
			left: 90%;
		}
		.text{
			border: 1px solid red;
			width: 300px;
			height: 40px;
			border-radius: 5px;
			outline: none;
		}
		.text:focus{
            box-shadow:0px 5px 10px black;
		}
		.button{
			width: 40px;
			height: 40px;
		}
		.search{
			position: relative;
			top: 40%;
			left: 40%;
		}
		.logins{
            width:120px;
            height:30px;
			display: inline-block;
			text-align: center;
			line-height: 30px;
			font-size: 12px;
		}
		.logins1{
            width:120px;
            height:30px;
			display: inline-block;
			text-align: center;
			line-height: 30px;
			font-size: 12px;
		}
		.exit{
			width:100px;
			height:40px;
			display: none;
			text-align: center;
			line-height: 30px;
        }
		.comment{
			width: 1140px;
			height: auto;
			background-color: white;
			opacity: 0.6;
			position: relative;
			border-bottom: 1px dotted black;
            display:none
		} 
		.fabiao{
			width: 80px;
			height: 40px;
			border: 0;
			background-color: orangered;
			text-align: center;
			line-height: 40px;
			color: white;
			outline: none;
			cursor: pointer;
		} 
		.text1{
			height: 50px;
			width: 1140px;
			outline: none;
		} 
		.zhezhao{
			width: 100px;
			height: 60px;
			position: absolute;
			top: 75px;
			left: 900px;
			z-index: 99;
			background:white;
			opacity: .8;
			animation: donghua 1s ease-out;
		}
		@keyframes donghua {
			from{
				height:0px;
				opacity: 0;
			}to{
				height:60px;
				opacity: 1;
			}
		}  
		.commentDiv{
			width: 100%;
			height: auto;
		}    
		.com1{
			display: none;
		}  
		.del{
			border: none;
			position: absolute;
			left: 1100px;
			top: 10px;
		}
		.href{
			display:inline-block;
			width: 20px;
			height: 20px;
			text-align: center;
			line-height:20px;
			cursor: pointer;
		}
	</style>
    
</head>
<body space-top-bot="50px">
    <div class="header">
		<div class="headernav">
			<div class="navlist">
				<a href="/">首页推荐</a>
				<a href="/c/1/page/1">历史传记</a>
				<a href="/c/2/page/1">经济管理</a>
				<a href="/c/3/page/1">小说文学</a>
				<a href="/c/4/page/1">励志成功</a>
				<a href="/c/5/page/1">人文社科</a>
				<a href="/c/6/page/1">生活时尚</a>
				<a href="/c/7/page/1">学习教育</a>
				<a href="/c/8/page/1">英文原版</a>
				<img src="/images/sousuo.svg" class="pic">
				<%if (userInfo){%>
					<div class="logins"> <span class="message" ><span style="width:40px;height:30px;display:inline-block;vertical-align: middle;"></span></span><img src='<%=userInfo[0].headimg%>' style='width: 30px;height: 30px;vertical-align: middle;border-radius:15px' title = '<%=userInfo[0].username%>'/></span class='exit'> </span class='exit'> <img src="/images/xiangxia.svg" style="vertical-align: middle;"></div>
				<%}else{%>
					<div class="logins1"><span><a href="/login">登录</a> </span>|<span><a href="/login">注册</a> </span></div>
					<%}%>
			</div>
		</div>
	</div>
	<div class="page-loading__icon"></div>
	<div class="frosted-panel" panel-dimensions="1250px auto" style="margin-top: 90px;">
		<svg>
			<filter id="blurMe" filterRes="1200" color-interpolation-filters="sRGB">
				<feGaussianBlur in="SourceGraphic" stdDeviation="7" />
			</filter>

			<image xlink:href="/images/bg1.jpg" x="0" y="0" width="2880" height="1620" filter="url(#blurMe)" />
		</svg>

		<div class="content" content-margin="50px" >
			<!-- ALL PANEL CONTENT GOES HERE -->
			<!-- .flex-container is for demo purposes only -->
				<div class="content">
                    <h3>类别：<%=book.sort%></h3>
                    <hr>
                    <img src="<%=book.bookimg%>" >
                    <p>书名：<%=book.bookname%></p>
                    <p>作者：<%=book.author%>·著</p>
                    <p>标签：<%=book.tag%></p>
                    <p>出版时间：<%=book.pubtime%></p>
                    <a href="<%=book.download%>" target="_blank" class="aaa">下载</a>
                    <div class="abrief">内容简介</div>
                    <p><%=book.brief%></p>
                    <div class="abrief1">作者简介</div>
                    <p><%=book.abrief%></p>
                    <div class="kongbai"></div>
                </div>
				<div class="commentDiv">
				<h3>读者评论:</h3>
				<%if(result1.length>0){%>
				<%for(i=0;i<result1.length;i++){%>
					<%if (userInfo){%>
						<%if(userInfo[0].username==result1[result1.length-1-i].user){%>
					<div class="comment">
					<span class="com1"><%-result1[result1.length-1-i].com1%></span>
                    <h6 style="color: black;text-indent: 10px;font-size: 12px;color:orangered;"> <%-result1[result1.length-1-i].user%>：</h6>
					<h6 style="color: black;text-indent: 115px;font-size: 14px;"><%-result1[result1.length-1-i].content%></h6>
					<button class="del">删除</button>
					</div>
					<%}else{%>
					<div class="comment">
					<h6 style="color: black;text-indent: 10px;font-size: 12px;"><%-result1[result1.length-1-i].user%>：</h6>
					<h6 style="color: black;text-indent: 115px;font-size: 14px;"><%-result1[result1.length-1-i].content%></h6>
				    </div>
					<%}%>
					<%}else{%>
					<div class="comment">
					<h6 style="color: black;text-indent: 10px;font-size: 12px;"><%-result1[result1.length-1-i].user%>：</h6>
					<h6 style="color: black;text-indent: 115px;font-size: 14px;"><%-result1[result1.length-1-i].content%></h6>
					</div>
					<%}%>	
                <%}%>
				<%}%>
			</div>
				<h3>发表评论：</h3>
				<input type="text" class="text1">
				<button class="fabiao">发表</button>
		</div>
	</div>
	<script>
		
		// var contentZ = document.querySelector('.content');
		// console.log(window.getComputedStyle(contentZ).height)
		// var height = window.getComputedStyle(contentZ).height
		// height = height.split('px')[0]
				var btn = document.querySelector('.fabiao')
		var text = document.querySelector('.text1')
		var commentDiv = document.querySelector('.commentDiv')
		var pin = document.querySelector('.comment')
		var arr = [];
		// let commentDIE = document.querySelectorAll('.comment')
		// console.log(commentDIE)
		// if(commentDIE.length == 0){
		// 	var h1 = document.createElement('h1')
		// 	commentDIE.appendchild
		// }
		// if(commentDIE.length>3){
		// 	commentDiv.style.height = '150px'
		// 	commentDiv.style.overflow='hidden'
		// }
		'<%if (userInfo){%>'
	    btn.onclick = function(){
			// contentZ.style.height =Number(height)+64+'px'
			// height = contentZ.style.height.split('px')[0]
			// location.href = "/comment/"+'<%-bookid%>/'+'<%-userInfo[0].username%>/'+text.value;
			var text1= text.value
			var xhr = new XMLHttpRequest();
			xhr.open('get',"/comment/"+'<%-bookid%>/'+'<%-userInfo[0].username%>/'+text.value)
			xhr.send()
			xhr.onreadystatechange = function(){
				if(xhr.readyState == 4){
				    setTimeout(function(){
						alert('发表成功')
					},100)	
				}
				
			}
			xhr.onload = function(){
			 console.log(JSON.parse(xhr.responseText))
			 arr = JSON.parse(xhr.responseText);
			//  console.log(arr)
			var comment = document.createElement('div')
			comment.classList.add('comment')
			comment.innerHTML=`<span class="com1">`+arr[arr.length-1].com1+`</span>
			<h6 style="color: black;text-indent: 10px;font-size: 12px;color:orangered;"><%-userInfo[0].username%>：</h6>
			<h6 style="color: black;text-indent: 115px;font-size: 14px;">`+arr[arr.length-1].content+`</h6>
			<button class="del">删除</button>`
			commentDiv.insertBefore(comment, commentDiv.children[1])
			
		//     let commentDIE = document.querySelectorAll('.comment')
		//     console.log(commentDIE)
		//     if(commentDIE.length>3){
		// 	commentDiv.style.height = '150px'
		// 	commentDiv.style.overflow='hidden'
		// }
		let commentpage = document.querySelectorAll('.comment')
		console.log(commentpage)
		for(let k=0;k<commentpage.length;k++){
			commentpage[k].style.display='none'
		}
		console.log(commentpage)
        let abtn1 = document.querySelectorAll('.href')
		for(let k=0;k<abtn1.length;k++){
			commentDiv.removeChild(abtn1[k])
		}
		if(commentpage.length>=5){
		for(let k=0;k<5;k++){
			commentpage[k].style.display='block'
		}
		console.log(abtn1)
		let pageAll =Math.ceil(commentpage.length/5)
		console.log(pageAll)
		// for(let k = 0;k<5;k++){
		// 				commentpage[k].style.display = 'block'
						
		// 			}
		
		for(let i=1; i<=pageAll;i++) {
			let a = document.createElement('a')
			a.innerText=i
			a.className='href'
			commentDiv.appendChild(a)
		}}else{
			for(let k=0;k<commentpage.length;k++){
			commentpage[k].style.display='block'
		}
		}
	    let abtn = document.querySelectorAll('.href')
		let pageAll =Math.ceil(commentpage.length/5)
		if(abtn.length>0){
		abtn[0].style.color = 'red'
		console.log(abtn)
		abtn.forEach(function(item,i){
			item.onclick = function(){
				console.log(item.innerText)
                let flag = Number(item.innerText);
				for(let k = 0;k<abtn.length;k++){
					abtn[k].style.color = 'black'
				}
				console.log(commentpage.length-(flag-1)*5)
				if(flag!=pageAll){
					for(let k = 0;k<commentpage.length;k++){
						commentpage[k].style.display = 'none'
					}
					for(let j=(flag-1)*5;j<(flag-1)*5+5;j++){
					commentpage[j].style.display = 'block'
					item.style.color = 'red'
				}
				}else{
					for(let k = 0;k<commentpage.length;k++){
						commentpage[k].style.display = 'none'
					}
					for(let j=(flag-1)*5;j< (flag-1)*5+(commentpage.length-(flag-1)*5);j++){
					commentpage[j].style.display = 'block'
					item.style.color = 'red'
				}
				}
				
			}
		})
	
		}
			let del = document.querySelectorAll('.del')
		    del.forEach(function(item,i){
            item.onclick = function(){
			// console.log(item.parentNode.children[0].innerText.substring(6,item.parentNode.children[0].innerText.length-1))
			// location.href = '/del/'+'<%-bookid%>/'+item.parentNode.children[0].innerText.substring(6,item.parentNode.children[0].innerText.length-1)+'/'+item.parentNode.children[1].innerText
			//创建ajax对象
			commentDiv.removeChild(item.parentNode)
			var xhr = new XMLHttpRequest();
			xhr.open('GET','/del/'+item.parentNode.children[0].innerText)
			xhr.send();
			xhr.onload = function() {
				alert(xhr.responseText)
			}
			let commentpage = document.querySelectorAll('.comment')
		console.log(commentpage)
		for(let k=0;k<commentpage.length;k++){
			commentpage[k].style.display='none'
		}
		console.log(commentpage)
        let abtn1 = document.querySelectorAll('.href')
		for(let k=0;k<abtn1.length;k++){
			commentDiv.removeChild(abtn1[k])
		}if(commentpage.length>=5){
		for(let k=0;k<5;k++){
			commentpage[k].style.display='block'
		}
		console.log(abtn1)
		let pageAll =Math.ceil(commentpage.length/5)
		console.log(pageAll)
		// for(let k = 0;k<5;k++){
		// 				commentpage[k].style.display = 'block'
						
		// 			}
		
		for(let i=1; i<=pageAll;i++) {
			let a = document.createElement('a')
			a.innerText=i
			a.className='href'
			commentDiv.appendChild(a)
		}}else{
			for(let k=0;k<commentpage.length;k++){
			commentpage[k].style.display='block'
		}
		}
	    let abtn = document.querySelectorAll('.href')
		let pageAll =Math.ceil(commentpage.length/5)
		if(abtn.length>0){ abtn[0].style.color = 'red'
		console.log(abtn)
		abtn.forEach(function(item,i){
			item.onclick = function(){
				console.log(item.innerText)
                let flag = Number(item.innerText);
				for(let k = 0;k<abtn.length;k++){
					abtn[k].style.color = 'black'
				}
				console.log(commentpage.length-(flag-1)*5)
				if(flag!=pageAll){
					for(let k = 0;k<commentpage.length;k++){
						commentpage[k].style.display = 'none'
					}
					for(let j=(flag-1)*5;j<(flag-1)*5+5;j++){
					commentpage[j].style.display = 'block'
					item.style.color = 'red'
				}
				}else{
					for(let k = 0;k<commentpage.length;k++){
						commentpage[k].style.display = 'none'
					}
					for(let j=(flag-1)*5;j< (flag-1)*5+(commentpage.length-(flag-1)*5);j++){
					commentpage[j].style.display = 'block'
					item.style.color = 'red'
				}
				}
				
			}
		})
		}}
		})
			}
			text.value = ''
		}
		'<%}else{%>'
		text.placeholder= '未登录，无法评论'
		text.disabled='true'
		'<%}%>'
		let del = document.querySelectorAll('.del')
		del.forEach(function(item,i){
        item.onclick = function(){
			// console.log(item.parentNode.children[0].innerText.substring(6,item.parentNode.children[0].innerText.length-1))
			// location.href = '/del/'+'<%-bookid%>/'+item.parentNode.children[0].innerText.substring(6,item.parentNode.children[0].innerText.length-1)+'/'+item.parentNode.children[1].innerText
			//创建ajax对象
			commentDiv.removeChild(item.parentNode)
			var xhr = new XMLHttpRequest();
			xhr.open('GET','/del/'+item.parentNode.children[0].innerText)
			xhr.send();
			xhr.onload = function() {
				alert(xhr.responseText)
			}
			let commentpage = document.querySelectorAll('.comment')
		console.log(commentpage)
		for(let k=0;k<commentpage.length;k++){
			commentpage[k].style.display='none'
		}
		console.log(commentpage)
        let abtn1 = document.querySelectorAll('.href')
		for(let k=0;k<abtn1.length;k++){
			commentDiv.removeChild(abtn1[k])
		}
		if(commentpage.length>=5){
		for(let k=0;k<5;k++){
			commentpage[k].style.display='block'
		}
		console.log(abtn1)
		let pageAll =Math.ceil(commentpage.length/5)
		console.log(pageAll)
		// for(let k = 0;k<5;k++){
		// 				commentpage[k].style.display = 'block'
						
		// 			}
		
		for(let i=1; i<=pageAll;i++) {
			let a = document.createElement('a')
			a.innerText=i
			a.className='href'
			commentDiv.appendChild(a)
		}}else{
			for(let k=0;k<commentpage.length;k++){
			commentpage[k].style.display='block'
		}
		}
	    let abtn = document.querySelectorAll('.href')
		let pageAll =Math.ceil(commentpage.length/5)
		if(abtn.length>0){
		abtn[0].style.color = 'red'
		console.log(abtn)
		abtn.forEach(function(item,i){
			item.onclick = function(){
				console.log(item.innerText)
                let flag = Number(item.innerText);
				for(let k = 0;k<abtn.length;k++){
					abtn[k].style.color = 'black'
				}
				console.log(commentpage.length-(flag-1)*5)
				if(flag!=pageAll){
					for(let k = 0;k<commentpage.length;k++){
						commentpage[k].style.display = 'none'
					}
					for(let j=(flag-1)*5;j<(flag-1)*5+5;j++){
					commentpage[j].style.display = 'block'
					item.style.color = 'red'
				}
				}else{
					for(let k = 0;k<commentpage.length;k++){
						commentpage[k].style.display = 'none'
					}
					for(let j=(flag-1)*5;j< (flag-1)*5+(commentpage.length-(flag-1)*5);j++){
					commentpage[j].style.display = 'block'
					item.style.color = 'red'
				}
				}
				
			}
		})
	}}
		})
		function page(){
		let commentpage = document.querySelectorAll('.comment')
		let pageAll =Math.ceil(commentpage.length/5)
		console.log(pageAll)
		if(commentpage.length>=5){
		for(let k = 0;k<5;k++){
						commentpage[k].style.display = 'block'
					}
		for(let i=1; i<=pageAll;i++) {
			let a = document.createElement('a')
			a.innerText=i
			a.className='href'
			commentDiv.appendChild(a)
		}}else{for(let k = 0;k<commentpage.length;k++){
						commentpage[k].style.display = 'block'
						
					}}
		let abtn = document.querySelectorAll('.href')
		if(abtn.length>0){abtn[0].style.color = 'red'
		console.log(abtn)
		abtn.forEach(function(item,i){
			item.onclick = function(){
				console.log(item.innerText)
                let flag = Number(item.innerText);
				for(let k = 0;k<abtn.length;k++){
					abtn[k].style.color = 'black'
				}
				console.log(commentpage.length-(flag-1)*5)
				if(flag!=pageAll){
					for(let k = 0;k<commentpage.length;k++){
						commentpage[k].style.display = 'none'
					}
					for(let j=(flag-1)*5;j<(flag-1)*5+5;j++){
					commentpage[j].style.display = 'block'
					item.style.color = 'red'
				}
				}else{
					for(let k = 0;k<commentpage.length;k++){
						commentpage[k].style.display = 'none'
					}
					for(let j=(flag-1)*5;j< (flag-1)*5+(commentpage.length-(flag-1)*5);j++){
					commentpage[j].style.display = 'block'
					item.style.color = 'red'
				}
				}
				
			}
		})}}
		page()
	</script>
	<script src="/javascripts/loginmes.js"></script>
	<script src="/javascripts/app.js"></script>
    <script src="/javascripts/sousuotankuang.js"></script>
</body>
</html>